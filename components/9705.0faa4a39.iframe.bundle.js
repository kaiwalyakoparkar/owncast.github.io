"use strict";(self.webpackChunkowncast_web=self.webpackChunkowncast_web||[]).push([[9705],{"./components/stores/ClientConfigStore.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ao:()=>ChatState,Xp:()=>ClientConfigStore,Dr:()=>accessTokenAtom,uy:()=>appStateAtom,td:()=>chatAuthenticatedAtom,in:()=>chatMessagesAtom,t2:()=>chatStateAtom,Ar:()=>clientConfigStateAtom,uL:()=>clockSkewAtom,gN:()=>currentUserAtom,DI:()=>fatalErrorStateAtom,F5:()=>isChatAvailableSelector,A4:()=>isMobileAtom,tp:()=>isOnlineSelector,Fb:()=>isVideoPlayingAtom,Bm:()=>serverStatusState,Qy:()=>visibleChatMessagesSelector,W5:()=>websocketServiceAtom});var toConsumableArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),es=__webpack_require__("./node_modules/recoil/es/index.js"),useMachine=__webpack_require__("./node_modules/@xstate/react/es/useMachine.js"),client_config_model=__webpack_require__("./interfaces/client-config.model.ts"),client_config_service=__webpack_require__("./services/client-config-service.ts"),chat_service=__webpack_require__("./services/chat-service.ts"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),socket_events=__webpack_require__("./interfaces/socket-events.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js"),WebsocketService=function(){return(0,createClass.A)((function WebsocketService(accessToken,path,host){(0,classCallCheck.A)(this,WebsocketService),(0,defineProperty.A)(this,"websocket",void 0),(0,defineProperty.A)(this,"accessToken",void 0),(0,defineProperty.A)(this,"host",void 0),(0,defineProperty.A)(this,"path",void 0),(0,defineProperty.A)(this,"websocketReconnectTimer",void 0),(0,defineProperty.A)(this,"isShutdown",!1),(0,defineProperty.A)(this,"backOff",0),(0,defineProperty.A)(this,"handleMessage",void 0),(0,defineProperty.A)(this,"socketConnected",void 0),(0,defineProperty.A)(this,"socketDisconnected",void 0),this.accessToken=accessToken,this.path=path,this.websocketReconnectTimer=null,this.isShutdown=!1,this.host=host,this.createAndConnect=this.createAndConnect.bind(this),this.shutdown=this.shutdown.bind(this),this.createAndConnect()}),[{key:"createAndConnect",value:function createAndConnect(){if(this.host&&!this.isShutdown){var url=new URL(this.host);url.protocol="https:"===window.location.protocol?"wss:":"ws:",url.pathname="/ws",url.port="3000"===window.location.port?"8080":window.location.port,url.searchParams.append("accessToken",this.accessToken);var ws=new WebSocket(url.toString());ws.onopen=this.onOpen.bind(this),ws.onerror=this.onError.bind(this),ws.onmessage=this.onMessage.bind(this),this.websocket=ws}}},{key:"onOpen",value:function onOpen(){this.websocketReconnectTimer&&clearTimeout(this.websocketReconnectTimer),this.socketConnected(),this.backOff=0}},{key:"onError",value:function onError(){!function handleNetworkingError(){console.error("Chat has been disconnected and is likely not working for you. It's possible you were removed from chat. If this is a server configuration issue, visit troubleshooting steps to resolve. https://owncast.online/docs/troubleshooting/#chat-is-disabled")}(),this.socketDisconnected(),this.websocket.close(),this.isShutdown||this.scheduleReconnect()}},{key:"scheduleReconnect",value:function scheduleReconnect(){this.isShutdown||(this.websocketReconnectTimer&&clearTimeout(this.websocketReconnectTimer),this.websocketReconnectTimer=setTimeout(this.createAndConnect,Math.min(this.backOff,1e4)),this.backOff+=1e3)}},{key:"shutdown",value:function shutdown(){this.isShutdown=!0,this.websocket.close()}},{key:"onMessage",value:function onMessage(e){for(var socketEvent,messages=e.data.split("\n"),i=0;i<messages.length;i++){try{socketEvent=JSON.parse(messages[i]),this.handleMessage&&this.handleMessage(socketEvent)}catch(err){return void console.error(err,err.data)}if(!socketEvent.type)return void console.error("No type provided",socketEvent);if(socketEvent.type===socket_events.G.PING)return void this.sendPong()}}},{key:"isConnected",value:function isConnected(){var _this$websocket,_this$websocket2;return(null===(_this$websocket=this.websocket)||void 0===_this$websocket?void 0:_this$websocket.readyState)===(null===(_this$websocket2=this.websocket)||void 0===_this$websocket2?void 0:_this$websocket2.OPEN)}},{key:"send",value:function send(socketEvent){socketEvent.type&&socket_events.G[socketEvent.type]||console.warn('Outbound message: Unknown socket message type: "'.concat(socketEvent.type,'" sent.'));var messageJSON=JSON.stringify(socketEvent);this.websocket.send(messageJSON)}},{key:"sendPong",value:function sendPong(){var pong={type:socket_events.G.PONG};this.send(pong)}}])}();var server_status_model=__webpack_require__("./interfaces/server-status.model.ts"),Machine=__webpack_require__("./node_modules/xstate/es/Machine.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var ONLINE_STATE={chatAvailable:!0,chatLoading:!1,videoAvailable:!0,appLoading:!1},AppStateEvent=function(AppStateEvent){return AppStateEvent.Loading="LOADING",AppStateEvent.Loaded="LOADED",AppStateEvent.Online="ONLINE",AppStateEvent.Offline="OFFLINE",AppStateEvent.NeedsRegister="NEEDS_REGISTER",AppStateEvent.Fail="FAIL",AppStateEvent.ChatUserDisabled="CHAT_USER_DISABLED",AppStateEvent}({});const application_state=(0,Machine.O)({id:"appState",initial:"loading",predictableActionArguments:!0,states:{loading:{meta:{chatAvailable:!1,chatLoading:!1,videoAvailable:!1,appLoading:!0},on:{NEEDS_REGISTER:{target:"loading"},LOADED:{target:"ready"},FAIL:{target:"serverFailure"}}},ready:{initial:"offline",states:{online:{meta:_objectSpread({},ONLINE_STATE),on:{OFFLINE:{target:"goodbye"},CHAT_USER_DISABLED:{target:"chatUserDisabled"}}},offline:{meta:_objectSpread({},{chatAvailable:!1,chatLoading:!1,videoAvailable:!1,appLoading:!1}),on:{ONLINE:{target:"online"}}},goodbye:{on:{ONLINE:{target:"online"}},meta:_objectSpread({},{chatAvailable:!0,chatLoading:!1,videoAvailable:!1,appLoading:!1}),after:{3e5:{target:"offline"}}},chatUserDisabled:{meta:_objectSpread(_objectSpread({},ONLINE_STATE),{},{chatAvailable:!1})}}},serverFailure:{type:"final"},userfailure:{type:"final"}}});var localStorage=__webpack_require__("./utils/localStorage.ts"),helpers=__webpack_require__("./utils/helpers.js");var status_service=__webpack_require__("./services/status-service.ts");function handleNameChangeEvent_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function handleNameChangeEvent_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?handleNameChangeEvent_ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):handleNameChangeEvent_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var ClientConfigStore_console=__webpack_require__("./node_modules/console-browserify/index.js");function ClientConfigStore_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function ClientConfigStore_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ClientConfigStore_ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ClientConfigStore_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}es.Or.RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED=!1;var serverStatusRefreshPoll,hasBeenModeratorNotified=!1,hasWebsocketDisconnected=!1,serverConnectivityError="Cannot connect to the Owncast service. Please check your internet connection and verify this Owncast server is running.",serverStatusState=(0,es.eU)({key:"serverStatusState",default:(0,server_status_model.x)()}),clientConfigStateAtom=(0,es.eU)({key:"clientConfigState",default:(0,client_config_model.n)()}),accessTokenAtom=(0,es.eU)({key:"accessTokenAtom",default:null}),currentUserAtom=(0,es.eU)({key:"currentUserAtom",default:null}),chatMessagesAtom=(0,es.eU)({key:"chatMessages",default:[]}),chatAuthenticatedAtom=(0,es.eU)({key:"chatAuthenticatedAtom",default:!1}),websocketServiceAtom=(0,es.eU)({key:"websocketServiceAtom",default:null,dangerouslyAllowMutability:!0}),appStateAtom=(0,es.eU)({key:"appState",default:{chatAvailable:!1,chatLoading:!0,videoAvailable:!1,appLoading:!0}}),isMobileAtom=(0,es.eU)({key:"isMobileAtom",default:void 0}),isVideoPlayingAtom=(0,es.eU)({key:"isVideoPlayingAtom",default:!1}),fatalErrorStateAtom=(0,es.eU)({key:"fatalErrorStateAtom",default:null}),clockSkewAtom=(0,es.eU)({key:"clockSkewAtom",default:0}),removedMessageIdsAtom=(0,es.eU)({key:"removedMessageIds",default:[]}),isChatAvailableSelector=(0,es.gD)({key:"isChatAvailableSelector",get:function get(_ref){var _get=_ref.get,state=_get(appStateAtom);return _get(accessTokenAtom)&&state.chatAvailable&&!hasWebsocketDisconnected}}),ChatState=function(ChatState){return ChatState[ChatState.VISIBLE=0]="VISIBLE",ChatState[ChatState.HIDDEN=1]="HIDDEN",ChatState[ChatState.POPPED_OUT=2]="POPPED_OUT",ChatState[ChatState.EMBEDDED=3]="EMBEDDED",ChatState}({}),chatStateAtom=(0,es.eU)({key:"chatState",default:function(_window$location){var window=globalThis;return"/embed/chat/readwrite/"===(null==window||null===(_window$location=window.location)||void 0===_window$location?void 0:_window$location.pathname)?ChatState.EMBEDDED:ChatState.VISIBLE}()}),isOnlineSelector=(0,es.gD)({key:"isOnlineSelector",get:function get(_ref2){var _get2=_ref2.get,state=_get2(appStateAtom),isVideoPlaying=_get2(isVideoPlayingAtom);return state.videoAvailable||isVideoPlaying}}),visibleChatMessagesSelector=(0,es.gD)({key:"visibleChatMessagesSelector",get:function get(_ref3){var _get3=_ref3.get,messages=_get3(chatMessagesAtom),removedIds=_get3(removedMessageIdsAtom);return messages.filter((function(message){return!removedIds.includes(message.id)}))}}),ClientConfigStore=function ClientConfigStore(){var ws,ClientConfigService=(0,react.useContext)(client_config_service.O),ChatService=(0,react.useContext)(chat_service.F),ServerStatusService=(0,react.useContext)(status_service.O),_useMachine=(0,useMachine.z)(application_state),_useMachine2=(0,slicedToArray.A)(_useMachine,3),appState=_useMachine2[0],appStateSend=_useMachine2[1],appStateService=_useMachine2[2],_useRecoilState=(0,es.L4)(currentUserAtom),_useRecoilState2=(0,slicedToArray.A)(_useRecoilState,2),currentUser=_useRecoilState2[0],setCurrentUser=_useRecoilState2[1],setChatAuthenticated=(0,es.lZ)(chatAuthenticatedAtom),_useRecoilState3=(0,es.L4)(clientConfigStateAtom),_useRecoilState4=(0,slicedToArray.A)(_useRecoilState3,2),clientConfig=_useRecoilState4[0],setClientConfig=_useRecoilState4[1],setServerStatus=(0,es.lZ)(serverStatusState),setClockSkew=(0,es.lZ)(clockSkewAtom),setChatMessages=(0,es.lZ)(chatMessagesAtom),_useRecoilState5=(0,es.L4)(accessTokenAtom),_useRecoilState6=(0,slicedToArray.A)(_useRecoilState5,2),accessToken=_useRecoilState6[0],setAccessToken=_useRecoilState6[1],setAppState=(0,es.lZ)(appStateAtom),setGlobalFatalErrorMessage=(0,es.lZ)(fatalErrorStateAtom),setWebsocketService=(0,es.lZ)(websocketServiceAtom),setHiddenMessageIds=(0,es.lZ)(removedMessageIdsAtom),_useState=(0,react.useState)(!1),hasLoadedConfig=_useState[0],setHasLoadedConfig=_useState[1],setGlobalFatalError=function setGlobalFatalError(title,message){setGlobalFatalErrorMessage({title,message})},sendEvent=function sendEvent(events){appStateSend(events)},handleStatusChange=function handleStatusChange(status){if(appState.matches("loading")){var events=[AppStateEvent.Loaded];return status.online?events.push(AppStateEvent.Online):events.push(AppStateEvent.Offline),void sendEvent(events)}status.online&&appState.matches("ready")?sendEvent([AppStateEvent.Online]):status.online||appState.matches("ready.offline")||sendEvent([AppStateEvent.Offline])},updateClientConfig=function(){var _ref4=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee(){var config;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,ClientConfigService.getConfig();case 3:config=_context.sent,setClientConfig(config),setGlobalFatalErrorMessage(null),setHasLoadedConfig(!0),_context.next=13;break;case 9:_context.prev=9,_context.t0=_context.catch(0),setGlobalFatalError("Unable to reach Owncast server",serverConnectivityError),ClientConfigStore_console.error("ClientConfigService -> getConfig() ERROR: \n",_context.t0);case 13:case"end":return _context.stop()}}),_callee,null,[[0,9]])})));return function updateClientConfig(){return _ref4.apply(this,arguments)}}(),updateServerStatus=function(){var _ref5=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee2(){var status,serverTime,clockSkew;return regenerator_default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=3,ServerStatusService.getStatus();case 3:status=_context2.sent,handleStatusChange(status),setServerStatus(status),serverTime=status.serverTime,clockSkew=new Date(serverTime).getTime()-Date.now(),setClockSkew(clockSkew),setGlobalFatalErrorMessage(null),_context2.next=17;break;case 12:_context2.prev=12,_context2.t0=_context2.catch(0),sendEvent([AppStateEvent.Fail]),setGlobalFatalError("Unable to reach Owncast server",serverConnectivityError),ClientConfigStore_console.error("serverStatusState -> getStatus() ERROR: \n",_context2.t0);case 17:case"end":return _context2.stop()}}),_callee2,null,[[0,12]])})));return function updateServerStatus(){return _ref5.apply(this,arguments)}}(),handleUserRegistration=function(){var _ref6=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee3(optionalDisplayName){var savedAccessToken,response,newAccessToken,newDisplayName,displayColor;return regenerator_default().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(savedAccessToken=(0,localStorage.Lg)("accessToken"))){_context3.next=4;break}return setAccessToken(savedAccessToken),_context3.abrupt("return");case 4:return _context3.prev=4,sendEvent([AppStateEvent.NeedsRegister]),_context3.next=8,ChatService.registerUser(optionalDisplayName);case 8:if(response=_context3.sent,newAccessToken=response.accessToken,newDisplayName=response.displayName,displayColor=response.displayColor,newAccessToken){_context3.next=12;break}return _context3.abrupt("return");case 12:setCurrentUser(ClientConfigStore_objectSpread(ClientConfigStore_objectSpread({},currentUser),{},{displayName:newDisplayName,displayColor})),setAccessToken(newAccessToken),(0,localStorage.ZB)("accessToken",newAccessToken),_context3.next=21;break;case 17:_context3.prev=17,_context3.t0=_context3.catch(4),sendEvent([AppStateEvent.Fail]),ClientConfigStore_console.error("ChatService -> registerUser() ERROR: \n".concat(_context3.t0));case 21:case"end":return _context3.stop()}}),_callee3,null,[[4,17]])})));return function handleUserRegistration(_x){return _ref6.apply(this,arguments)}}(),handleSocketDisconnect=function handleSocketDisconnect(){hasWebsocketDisconnected=!0},handleSocketConnected=function handleSocketConnected(){hasWebsocketDisconnected=!1},handleMessage=function handleMessage(message){switch(message.type){case socket_events.G.ERROR_NEEDS_REGISTRATION:!function resetAndReAuth(){var _ws;(0,localStorage.ZB)("accessToken",""),setAccessToken(null),null===(_ws=ws)||void 0===_ws||_ws.shutdown(),handleUserRegistration()}();break;case socket_events.G.CONNECTED_USER_INFO:if(function handleConnectedClientInfoMessage(message,setChatAuthenticated,setCurrentUser){var user=message.user,id=user.id,displayName=user.displayName,displayColor=user.displayColor,scopes=user.scopes;setChatAuthenticated(user.authenticated),setCurrentUser({id:id.toString(),displayName,displayColor,isModerator:null==scopes?void 0:scopes.includes("MODERATOR")})}(message,setChatAuthenticated,setCurrentUser),message){var _m$user,m=new socket_events.b(message);!hasBeenModeratorNotified&&null!==(_m$user=m.user)&&void 0!==_m$user&&_m$user.isModerator&&(setChatMessages((function(currentState){return[].concat((0,toConsumableArray.A)(currentState),[message])})),hasBeenModeratorNotified=!0)}break;case socket_events.G.CHAT:setChatMessages((function(currentState){return[].concat((0,toConsumableArray.A)(currentState),[message])}));break;case socket_events.G.NAME_CHANGE:!function handleNameChangeEvent(message,setChatMessages,setCurrentUser){setCurrentUser((function(currentUser){return currentUser.id===message.user.id?handleNameChangeEvent_objectSpread(handleNameChangeEvent_objectSpread({},currentUser),{},{displayName:message.user.displayName}):currentUser})),setChatMessages((function(currentState){return[].concat((0,toConsumableArray.A)(currentState),[message])}))}(message,setChatMessages,setCurrentUser);break;case socket_events.G.USER_JOINED:case socket_events.G.USER_PARTED:case socket_events.G.SYSTEM:case socket_events.G.CHAT_ACTION:case socket_events.G.FEDIVERSE_ENGAGEMENT_FOLLOW:case socket_events.G.FEDIVERSE_ENGAGEMENT_LIKE:case socket_events.G.FEDIVERSE_ENGAGEMENT_REPOST:setChatMessages((function(currentState){return[].concat((0,toConsumableArray.A)(currentState),[message])}));break;case socket_events.G.VISIBILITY_UPDATE:!function handleMessageVisibilityChange(message){var ids=message.ids,visible=message.visible;setHiddenMessageIds(visible?function(currentState){return currentState.filter((function(id){return!ids.includes(id)}))}:function(currentState){return[].concat((0,toConsumableArray.A)(currentState),(0,toConsumableArray.A)(ids))})}(message);break;case socket_events.G.ERROR_USER_DISABLED:ClientConfigStore_console.log("User has been disabled"),sendEvent([AppStateEvent.ChatUserDisabled]);break;default:ClientConfigStore_console.error("Unknown socket message type: ",message.type)}},getChatHistory=function(){var _ref7=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee4(){var messages;return regenerator_default().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,ChatService.getChatHistory(accessToken);case 3:(messages=_context4.sent)&&setChatMessages((function(currentState){return[].concat((0,toConsumableArray.A)(currentState),(0,toConsumableArray.A)(messages))})),_context4.next=10;break;case 7:_context4.prev=7,_context4.t0=_context4.catch(0),ClientConfigStore_console.error("ChatService -> getChatHistory() ERROR: \n".concat(_context4.t0));case 10:case"end":return _context4.stop()}}),_callee4,null,[[0,7]])})));return function getChatHistory(){return _ref7.apply(this,arguments)}}(),startChat=function(){var _ref8=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee5(){var _ws2,socketHostOverride,location;return regenerator_default().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:try{ws&&(null===(_ws2=ws)||void 0===_ws2||_ws2.shutdown(),setWebsocketService(null),ws=null),socketHostOverride=clientConfig.socketHostOverride,location=window.location.origin+window.location.pathname,(ws=new WebsocketService(accessToken,"/ws",socketHostOverride||location)).handleMessage=handleMessage,ws.socketDisconnected=handleSocketDisconnect,ws.socketConnected=handleSocketConnected,setWebsocketService(ws)}catch(error){ClientConfigStore_console.error("ChatService -> startChat() ERROR: \n".concat(error)),sendEvent([AppStateEvent.ChatUserDisabled])}case 1:case"end":return _context5.stop()}}),_callee5)})));return function startChat(){return _ref8.apply(this,arguments)}}();return(0,react.useEffect)((function(){try{if(window.configHydration){var config=JSON.parse(window.configHydration);setClientConfig(config),setHasLoadedConfig(!0)}}catch(e){ClientConfigStore_console.error("Error parsing config hydration",e)}try{if(window.statusHydration){var status=JSON.parse(window.statusHydration);setServerStatus(status),handleStatusChange(status)}}catch(e){ClientConfigStore_console.error("error parsing status hydration",e)}try{window.configHydration&&window.statusHydration&&sendEvent([AppStateEvent.Loaded])}catch(e){ClientConfigStore_console.error("error sending loaded event",e)}}),[]),(0,react.useEffect)((function(){clientConfig.chatDisabled||accessToken&&hasLoadedConfig&&(ws||startChat())}),[hasLoadedConfig,accessToken]),(0,react.useEffect)((function(){return window.configHydration||updateClientConfig(),handleUserRegistration(),window.statusHydration||updateServerStatus(),clearInterval(serverStatusRefreshPoll),serverStatusRefreshPoll=setInterval((function(){updateServerStatus()}),5e3),function(){clearInterval(serverStatusRefreshPoll)}}),[]),(0,react.useEffect)((function(){accessToken&&getChatHistory()}),[accessToken]),(0,react.useEffect)((function(){appStateService.onTransition((function(state){var metadata=(0,helpers.Cl)(state.meta);setAppState(metadata)}))}),[]),null};try{ClientConfigStore.displayName="ClientConfigStore",ClientConfigStore.__docgenInfo={description:"",displayName:"ClientConfigStore",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/stores/ClientConfigStore.tsx#ClientConfigStore"]={docgenInfo:ClientConfigStore.__docgenInfo,name:"ClientConfigStore",path:"components/stores/ClientConfigStore.tsx#ClientConfigStore"})}catch(__react_docgen_typescript_loader_error){}},"./interfaces/client-config.model.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function makeEmptyClientConfig(){return{name:"",summary:"",offlineMessage:"",logo:"",tags:[],nsfw:!1,extraPageContent:"",socialHandles:[],chatDisabled:!1,externalActions:[],customStyles:"",appearanceVariables:new Map,maxSocketPayloadSize:0,federation:{enabled:!1,account:"",followerCount:0},notifications:{browser:{enabled:!1,publicKey:""}},authentication:{indieAuthEnabled:!1}}}__webpack_require__.d(__webpack_exports__,{n:()=>makeEmptyClientConfig})},"./interfaces/server-status.model.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function makeEmptyServerStatus(){return{online:!1,viewerCount:0,serverTime:new Date}}__webpack_require__.d(__webpack_exports__,{x:()=>makeEmptyServerStatus})},"./interfaces/socket-events.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>MessageType,b:()=>ChatEvent});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_user_model__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./interfaces/user.model.ts"),MessageType=function(MessageType){return MessageType.CHAT="CHAT",MessageType.PING="PING",MessageType.NAME_CHANGE="NAME_CHANGE",MessageType.COLOR_CHANGE="COLOR_CHANGE",MessageType.PONG="PONG",MessageType.SYSTEM="SYSTEM",MessageType.USER_JOINED="USER_JOINED",MessageType.USER_PARTED="USER_PARTED",MessageType.CHAT_ACTION="CHAT_ACTION",MessageType.FEDIVERSE_ENGAGEMENT_FOLLOW="FEDIVERSE_ENGAGEMENT_FOLLOW",MessageType.FEDIVERSE_ENGAGEMENT_LIKE="FEDIVERSE_ENGAGEMENT_LIKE",MessageType.FEDIVERSE_ENGAGEMENT_REPOST="FEDIVERSE_ENGAGEMENT_REPOST",MessageType.CONNECTED_USER_INFO="CONNECTED_USER_INFO",MessageType.ERROR_USER_DISABLED="ERROR_USER_DISABLED",MessageType.ERROR_NEEDS_REGISTRATION="ERROR_NEEDS_REGISTRATION",MessageType.ERROR_MAX_CONNECTIONS_EXCEEDED="ERROR_MAX_CONNECTIONS_EXCEEDED",MessageType.VISIBILITY_UPDATE="VISIBILITY-UPDATE",MessageType}({}),ChatEvent=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_0__.A)((function ChatEvent(message){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_1__.A)(this,ChatEvent),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"timestamp",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"type",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"id",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"user",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"body",void 0),this.id=message.id,this.timestamp=message.timestamp,this.type=message.type,this.body=message.body,message.user&&(this.user=new _user_model__WEBPACK_IMPORTED_MODULE_3__.K(message.user))}))},"./interfaces/user.model.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>User});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),User=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_0__.A)((function User(u){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_1__.A)(this,User),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"id",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"displayName",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"displayColor",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"createdAt",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"previousNames",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"nameChangedAt",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"scopes",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"authenticated",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"isBot",void 0),(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,"isModerator",void 0),this.id=u.id,this.displayName=u.displayName,this.displayColor=u.displayColor,this.createdAt=u.createdAt,this.previousNames=u.previousNames,this.nameChangedAt=u.nameChangedAt,this.scopes=u.scopes,this.authenticated=u.authenticated,this.isBot=u.isBot,this.scopes&&this.scopes.length>0&&(this.isModerator=this.scopes.includes("MODERATOR"))}))},"./utils/helpers.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Cl:()=>mergeMeta,X4:()=>isMobileSafariHomeScreenApp,ei:()=>isMobileSafariIos,kt:()=>getDiffInDaysFromNow});var ua_parser_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ua-parser-js/src/ua-parser.js"),ua_parser_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(ua_parser_js__WEBPACK_IMPORTED_MODULE_0__);function getDiffInDaysFromNow(timestamp){var time="string"==typeof timestamp?new Date(timestamp):timestamp;return(new Date-time)/864e5}function mergeMeta(meta){return Object.keys(meta).reduce((function(acc,key){var value=meta[key];return Object.assign(acc,value),acc}),{})}var isMobileSafariIos=function isMobileSafariIos(){try{var ua=navigator.userAgent,uaParser=new(ua_parser_js__WEBPACK_IMPORTED_MODULE_0___default())(ua),browser=uaParser.getBrowser(),device=uaParser.getDevice();return"Apple"===device.vendor&&(("mobile"===device.type||"tablet"===device.type)&&("Mobile Safari"===browser.name||"Safari"===browser.name))}catch(e){return!1}},isMobileSafariHomeScreenApp=function isMobileSafariHomeScreenApp(){return!!isMobileSafariIos()&&("standalone"in window.navigator&&window.navigator.standalone)}},"./services/chat-service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>ChatServiceContext});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_utils_apis__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./utils/apis.ts"),ChatService=function(){return(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_4__.A)((function ChatService(){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_3__.A)(this,ChatService)}),null,[{key:"getChatHistory",value:(_getChatHistory=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(accessToken){var response;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,(0,_utils_apis__WEBPACK_IMPORTED_MODULE_2__.DW)("".concat("/api/chat","?accessToken=").concat(accessToken));case 3:return response=_context.sent,_context.abrupt("return",response);case 7:return _context.prev=7,_context.t0=_context.catch(0),_context.abrupt("return",[]);case 10:case"end":return _context.stop()}}),_callee,null,[[0,7]])}))),function getChatHistory(_x){return _getChatHistory.apply(this,arguments)})},{key:"registerUser",value:(_registerUser=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee2(username){var options,response;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return options={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:username})},_context2.next=3,(0,_utils_apis__WEBPACK_IMPORTED_MODULE_2__.DW)("/api/chat/register",options);case 3:return response=_context2.sent,_context2.abrupt("return",response);case 5:case"end":return _context2.stop()}}),_callee2)}))),function registerUser(_x2){return _registerUser.apply(this,arguments)})}]);var _registerUser,_getChatHistory}(),ChatServiceContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(ChatService)},"./services/client-config-service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ClientConfigServiceContext});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),ClientConfigService=function(){return(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_3__.A)((function ClientConfigService(){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,ClientConfigService)}),null,[{key:"getConfig",value:(_getConfig=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(){var response,status;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch("/api/config");case 2:return response=_context.sent,_context.next=5,response.json();case 5:return status=_context.sent,_context.abrupt("return",status);case 7:case"end":return _context.stop()}}),_callee)}))),function getConfig(){return _getConfig.apply(this,arguments)})}]);var _getConfig}(),ClientConfigServiceContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(ClientConfigService)},"./services/status-service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ServerStatusServiceContext});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),ServerStatusService=function(){return(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_3__.A)((function ServerStatusService(){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_2__.A)(this,ServerStatusService)}),null,[{key:"getStatus",value:(_getStatus=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(){var response,status;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch("/api/status");case 2:return response=_context.sent,_context.next=5,response.json();case 5:return status=_context.sent,_context.abrupt("return",status);case 7:case"end":return _context.stop()}}),_callee)}))),function getStatus(){return _getStatus.apply(this,arguments)})}]);var _getStatus}(),ServerStatusServiceContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(ServerStatusService)},"./utils/apis.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D0:()=>FEDERATION_MESSAGE_SEND,DW:()=>getUnauthedData,Fd:()=>fetchData,Fq:()=>SERVER_CONFIG,XQ:()=>STATUS,e0:()=>upgradeVersionAvailable,nn:()=>SERVER_CONFIG_UPDATE_URL,r1:()=>FETCH_INTERVAL});var _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__),process=__webpack_require__("./node_modules/process/browser.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var ADMIN_USERNAME=process.env.NEXT_PUBLIC_ADMIN_USERNAME,ADMIN_STREAMKEY=process.env.NEXT_PUBLIC_ADMIN_STREAMKEY,API_LOCATION="".concat("/","api/admin/"),FETCH_INTERVAL=15e3,STATUS="".concat(API_LOCATION,"status"),SERVER_CONFIG="".concat(API_LOCATION,"serverconfig"),SERVER_CONFIG_UPDATE_URL="".concat(API_LOCATION,"config"),FEDERATION_MESSAGE_SEND=("".concat(API_LOCATION,"viewersOverTime"),"".concat(API_LOCATION,"viewers"),"".concat(API_LOCATION,"chat/clients"),"".concat(API_LOCATION,"chat/users/disabled"),"".concat(API_LOCATION,"chat/users/setenabled"),"".concat(API_LOCATION,"chat/users/ipbans"),"".concat(API_LOCATION,"chat/users/ipbans/remove"),"".concat(API_LOCATION,"chat/users/setmoderator"),"".concat(API_LOCATION,"chat/users/moderators"),"".concat(API_LOCATION,"hardwarestats"),"".concat(API_LOCATION,"logs"),"".concat(API_LOCATION,"logs/warnings"),"".concat(API_LOCATION,"chat/messages"),"".concat(API_LOCATION,"emoji/upload"),"".concat(API_LOCATION,"emoji/delete"),"".concat(API_LOCATION,"accesstokens"),"".concat(API_LOCATION,"accesstokens/delete"),"".concat(API_LOCATION,"accesstokens/create"),"".concat(API_LOCATION,"webhooks"),"".concat(API_LOCATION,"webhooks/delete"),"".concat(API_LOCATION,"webhooks/create"),"".concat("/","api/socialplatforms"),"".concat(API_LOCATION,"federation/send")),GITHUB_RELEASE_URL=("".concat(API_LOCATION,"followers"),"".concat(API_LOCATION,"followers/pending"),"".concat(API_LOCATION,"followers/blocked"),"".concat(API_LOCATION,"followers/approve"),"".concat(API_LOCATION,"federation/actions"),"".concat(API_LOCATION,"metrics/video"),"".concat(API_LOCATION,"config/streamkeys"),"".concat(API_LOCATION,"yp/reset"),"https://api.github.com/repos/owncast/owncast/releases/latest");function fetchData(_x,_x2){return _fetchData.apply(this,arguments)}function _fetchData(){return(_fetchData=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee(url,options){var _ref,data,_ref$method,method,_ref$auth,auth,requestOptions,encoded,response,json,message;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return data=(_ref=options||{}).data,_ref$method=_ref.method,method=void 0===_ref$method?"GET":_ref$method,_ref$auth=_ref.auth,auth=void 0===_ref$auth||_ref$auth,requestOptions={method},data&&(requestOptions.body=JSON.stringify(data)),auth&&ADMIN_USERNAME&&ADMIN_STREAMKEY&&(encoded=btoa("".concat(ADMIN_USERNAME,":").concat(ADMIN_STREAMKEY)),requestOptions.headers={Authorization:"Basic ".concat(encoded)},requestOptions.mode="cors",requestOptions.credentials="include"),_context.next=6,fetch(url,requestOptions);case 6:return response=_context.sent,_context.next=9,response.json();case 9:if(json=_context.sent,response.ok){_context.next=13;break}throw message=json.message||"An error has occurred: ".concat(response.status),new Error(message);case 13:return _context.abrupt("return",json);case 14:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function getUnauthedData(_x3,_x4){return _getUnauthedData.apply(this,arguments)}function _getUnauthedData(){return(_getUnauthedData=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee2(url,options){var opts;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return opts=_objectSpread({method:"GET",auth:!1},options),_context2.abrupt("return",fetchData(url,opts));case 2:case"end":return _context2.stop()}}),_callee2)})))).apply(this,arguments)}function fetchExternalData(_x5){return _fetchExternalData.apply(this,arguments)}function _fetchExternalData(){return(_fetchExternalData=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee3(url){var response,message,json;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,fetch(url,{referrerPolicy:"no-referrer",referrer:""});case 3:if((response=_context3.sent).ok){_context3.next=7;break}throw message="An error has occured: ".concat(response.status),new Error(message);case 7:return _context3.next=9,response.json();case 9:return json=_context3.sent,_context3.abrupt("return",json);case 13:_context3.prev=13,_context3.t0=_context3.catch(0),console.log(_context3.t0);case 16:return _context3.abrupt("return",{});case 17:case"end":return _context3.stop()}}),_callee3,null,[[0,13]])})))).apply(this,arguments)}function getGithubRelease(){return _getGithubRelease.apply(this,arguments)}function _getGithubRelease(){return(_getGithubRelease=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee4(){return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",fetchExternalData(GITHUB_RELEASE_URL));case 1:case"end":return _context4.stop()}}),_callee4)})))).apply(this,arguments)}var VPAT=/^\d+(\.\d+){0,2}$/;function upToDate(local,remote){if(!local||!remote||0===local.length||0===remote.length)return!1;if(local===remote)return!0;if(VPAT.test(local)&&VPAT.test(remote)){for(var lparts=local.split(".");lparts.length<3;)lparts.push("0");for(var rparts=remote.split(".");rparts.length<3;)rparts.push("0");for(var i=0;i<3;i++){var l=parseInt(lparts[i],10),r=parseInt(rparts[i],10);if(l!==r)return l>r}return!0}return local>=remote}function upgradeVersionAvailable(_x6){return _upgradeVersionAvailable.apply(this,arguments)}function _upgradeVersionAvailable(){return(_upgradeVersionAvailable=(0,_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.A)(_tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee5(currentVersion){var recentRelease,recentReleaseVersion;return _tmp_tmp_r3SeZjawMQ_owncast_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,getGithubRelease();case 2:if(recentRelease=_context5.sent,"v"===(recentReleaseVersion=recentRelease.tag_name).substr(0,1)&&(recentReleaseVersion=recentReleaseVersion.substr(1)),upToDate(currentVersion,recentReleaseVersion)){_context5.next=7;break}return _context5.abrupt("return",recentReleaseVersion);case 7:return _context5.abrupt("return",null);case 8:case"end":return _context5.stop()}}),_callee5)})))).apply(this,arguments)}},"./utils/localStorage.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Lg:()=>getLocalStorage,ZB:()=>setLocalStorage,rS:()=>LOCAL_STORAGE_KEYS});var console=__webpack_require__("./node_modules/console-browserify/index.js"),LOCAL_STORAGE_KEYS={username:"username",hasDisplayedNotificationModal:"HAS_DISPLAYED_NOTIFICATION_MODAL",userVisitCount:"USER_VISIT_COUNT"};function getLocalStorage(key){try{return localStorage.getItem(key)}catch(e){console.error(e)}return null}function setLocalStorage(key,value){try{return""!==value&&null!==value?localStorage.setItem(key,value):localStorage.removeItem(key),!0}catch(e){console.error(e)}return!1}}}]);